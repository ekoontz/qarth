<!DOCTYPE html>
<html><head><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>qarth.oauth.lib documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Qarth 0.1.0-SNAPSHOT API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><span>Namespaces</span></h3><ul><li><a href="qarth.auth.html"><span>qarth.auth</span></a></li><li><a href="qarth.friend.html"><span>qarth.friend</span></a></li><li><a href="qarth.impl.facebook.html"><span>qarth.impl.facebook</span></a></li><li><a href="qarth.impl.github.html"><span>qarth.impl.github</span></a></li><li><a href="qarth.impl.google.html"><span>qarth.impl.google</span></a></li><li><a href="qarth.impl.scribe.html"><span>qarth.impl.scribe</span></a></li><li><a href="qarth.impl.yahoo.html"><span>qarth.impl.yahoo</span></a></li><li><a href="qarth.oauth.html"><span>qarth.oauth</span></a></li><li class="current"><a href="qarth.oauth.lib.html"><span>qarth.oauth.lib</span></a></li><li><a href="qarth.util.html"><span>qarth.util</span></a></li></ul></div><div class="sidebar" id="vars"><h3>Public Vars</h3><ul><li><a href="qarth.oauth.lib.html#var-activate-record"><span>activate-record</span></a></li><li><a href="qarth.oauth.lib.html#var-csrf-token"><span>csrf-token</span></a></li><li><a href="qarth.oauth.lib.html#var-do-activate"><span>do-activate</span></a></li><li><a href="qarth.oauth.lib.html#var-do-extract-code"><span>do-extract-code</span></a></li><li><a href="qarth.oauth.lib.html#var-do-new-record"><span>do-new-record</span></a></li><li><a href="qarth.oauth.lib.html#var-jwt-read"><span>jwt-read</span></a></li><li><a href="qarth.oauth.lib.html#var-remove-nils"><span>remove-nils</span></a></li><li><a href="qarth.oauth.lib.html#var-v2-form-parser"><span>v2-form-parser</span></a></li><li><a href="qarth.oauth.lib.html#var-v2-json-parser"><span>v2-json-parser</span></a></li></ul></div><div class="namespace-docs" id="content"><h2>qarth.oauth.lib documentation</h2><pre class="doc">Helper fns for OAuth implementations.
</pre><div class="public" id="var-activate-record"><h3>activate-record</h3><div class="usage"><code>(activate-record record param-map)</code></div><pre class="doc">Helper fn for OAuth records. Dissocs :url and :state,
and adds the given keys and values.</pre><div class="src-link"><a href="http://github.com/eightnotrump/qarth/blob/master/src/qarth/oauth/lib.clj#L162">Source</a></div></div><div class="public" id="var-csrf-token"><h3>csrf-token</h3><div class="usage"><code>(csrf-token)</code></div><pre class="doc">Returns a random base-64 encoded 12-byte CSRF token.
</pre><div class="src-link"><a href="http://github.com/eightnotrump/qarth/blob/master/src/qarth/oauth/lib.clj#L14">Source</a></div></div><div class="public" id="var-do-activate"><h3>do-activate</h3><div class="usage"><code>(do-activate service record code url parser)</code></div><pre class="doc">Helper fn for OAuth v2 services. Uses clj-http to execute a token request
(described in make-token-request) and parses the response using the given parser fn.

The parser should return a map containing at least the key :access-token
and the optional key :expires-in. All keys will be added to the record.

service -- the auth service
record -- the auth record
code -- the auth code
url -- the access token url
parser -- a fn response-stream -&gt; map, should return at least an :access-token
(be careful not to return access_token instead!)

The response stream will be closed if it isn't closed already when done.</pre><div class="src-link"><a href="http://github.com/eightnotrump/qarth/blob/master/src/qarth/oauth/lib.clj#L170">Source</a></div></div><div class="public" id="var-do-extract-code"><h3>do-extract-code</h3><div class="usage"><code>(do-extract-code our-state {params :params, :as req} state-fn code-fn error-fn)</code></div><pre class="doc">Helper fn for implementors to extract an auth code from a Ring request.
Looks for the params in the givne Ring request.
Returns the found auth code, nil if no state or code was found,
or throws an exception if an error or token mismatch were found.

our-state -- the state token in the record
req -- the request
state-fn -- finds the state token in the params
code-fn -- finds the auth code in the params
error-fn -- finds the error in the params

In standard OAuth v2, state-fn, code-fn and error-fn are
:state, :code and :error respectively.</pre><div class="src-link"><a href="http://github.com/eightnotrump/qarth/blob/master/src/qarth/oauth/lib.clj#L60">Source</a></div></div><div class="public" id="var-do-new-record"><h3>do-new-record</h3><div class="usage"><code>(do-new-record {type :type, client_id :api-key, request-url :request-url, callback :callback, scope :scope, :as service} url extra-params)</code></div><pre class="doc">Helper fn for new record suitable for standard OAuth v2.

Returns a new record with these fields:
:type -- same as the given service
:state -- a random state token
:url -- a GET-formatted url with standard OAuth v2 params

URL params:
:client_id -- our :api-key
:state -- the state token
:response_type -- &quot;code&quot;
:redirect_uri (optional) -- the service :callback, if configured
:scope (optional) -- the service :scope, if configured
other params given by extra-params</pre><div class="src-link"><a href="http://github.com/eightnotrump/qarth/blob/master/src/qarth/oauth/lib.clj#L26">Source</a></div></div><div class="public" id="var-jwt-read"><h3>jwt-read</h3><div class="usage"><code>(jwt-read fields)</code></div><pre class="doc">Decodes a URL-encoded JSON Web Token and returns its body.
Does not validate the JWT--use only if the JWT is trusted.</pre><div class="src-link"><a href="http://github.com/eightnotrump/qarth/blob/master/src/qarth/oauth/lib.clj#L151">Source</a></div></div><div class="public" id="var-remove-nils"><h3>remove-nils</h3><div class="usage"><code>(remove-nils m)</code></div><pre class="doc">Remove nil keys from a map.
</pre><div class="src-link"><a href="http://github.com/eightnotrump/qarth/blob/master/src/qarth/oauth/lib.clj#L20">Source</a></div></div><div class="public" id="var-v2-form-parser"><h3>v2-form-parser</h3><div class="usage"><code>(v2-form-parser response-stream)</code></div><pre class="doc">Parser for use with do-request-access. Reads a form-encoded response stream.
</pre><div class="src-link"><a href="http://github.com/eightnotrump/qarth/blob/master/src/qarth/oauth/lib.clj#L120">Source</a></div></div><div class="public" id="var-v2-json-parser"><h3>v2-json-parser</h3><div class="usage"><code>(v2-json-parser response-stream)</code></div><pre class="doc">Parser for use with do-request-access. Reads a JSON-encoded response stream.
</pre><div class="src-link"><a href="http://github.com/eightnotrump/qarth/blob/master/src/qarth/oauth/lib.clj#L108">Source</a></div></div></div></body></html>